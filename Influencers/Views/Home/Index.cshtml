@model List<Influencers.BusinessLogic.ViewModels.ArticleViewModel>
@{
    ViewData["Title"] = "Home Page";
    int[] top3Votes = new int[3] {-9999999, -9999999, -9999999 };
    String[] authorsNameTop3 = new String[3] {"-", "-", "-"};
    
    // de incercat - top 3 authori dupa Value(nr de voturi)
    Dictionary<string, int> Score = new Dictionary<string, int>();
}

<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="~/css/preview_posts.css">
    <link rel="stylesheet" href="~/css/buttons_posts.css">
</head>
<body>

    <div class="text-center">
        <h3 class="display-4">Welcome</h3>
    </div>

    <div class="row">
        <div class="leftcolumn">
            @foreach (var article in Model)
            {
                if (@article.Votes > top3Votes[0])
                {
                    // shiftez totul spre drepta 2 pozitii
                    for (int index = 2; index >= 1; --index)
                    {
                        top3Votes[index] = top3Votes[index - 1];
                        authorsNameTop3[index] = authorsNameTop3[index - 1];
                    }
                    top3Votes[0] = @article.Votes;
                    authorsNameTop3[0] = @article.AuthorName ;
                } else if (@article.Votes > top3Votes[1])
                {
                    //shiftez spre dreapta 1 pozitie
                    top3Votes[2] = top3Votes[1];
                    authorsNameTop3[2] = authorsNameTop3[1];

                    top3Votes[1] = @article.Votes;
                    authorsNameTop3[1] = @article.AuthorName;
                } else if (@article.Votes > top3Votes[2])
                {
                    top3Votes[2] = @article.Votes;
                    authorsNameTop3[2] = @article.AuthorName;
                }

                <div class="card">
                    <center><h3>@article.Title</h3></center>
                    <h5>@article.Date, @article.AuthorName</h5>
                    <p>@article.Content.Substring(0, 4)...</p>
                    <div class="row">
                        <div class="col-sm-6">

                            <div class="scoring1">
                                    <select id="@article.ArticleId" onchange="f(@article.ArticleId)" class="form-control" asp-for="@article.Votes">
                                        <option value="1"></option>
                                        <option value="-5">😡</option>
                                        <option value="-2">😱</option>
                                        <option value="-1">😢</option>
                                        <option value="0">🙏</option>
                                        <option value="1">👽</option>
                                        <option value="2">😜</option>
                                        <option value="10">😂</option>
                                        <option value="50">🚀</option>
                                    </select> 
                            </div>
                            <div class="scoring2">
                                Score: @article.Votes
                            </div>

                        </div>


                        <div class="col-sm-0">
                            <a asp-action="ReadMore" asp-route-id="@article.ArticleId" asp-controller="Home" class="GFG" style="text-decoration : none">Read more</a>
                        </div>

                        <div class="col-sm-0">
                            <a asp-action="EditThis" asp-route-id="@article.ArticleId" asp-controller="Home" class="GFG" style="text-decoration : none">Edit this</a>

                        </div>
                    </div>
                </div>

            }
                <br />
        </div>
        <div class="rightcolumn">
            <div class="card">
                <h4><a asp-action="Leaderboard" asp-controller="Home" class="board" style="text-decoration : none">Popular influencers</a></h4>
                <ol>
                    @for (int index = 0; index < 3; ++index)
                    {
                        <li>@authorsNameTop3[index] Score:@top3Votes[index]</li>
                    }

                </ol>
            </div>
        </div>
    </div>

</body>
</html>

@section scripts{
    <script src="~/lib/jquery/dist/jquery.min.js"> </script>
<script>      
// var e = document.getElementById("article_Votes");
        // var selectedScore = e.options[e.selectedIndex].value;
        //console.log(selectedScore);
    function f(articleId) {
        let x = $('#' + articleId).val();
        //console.log([articleId, x]);
        $.ajax({
            type: "POST", // request type here
            data: JSON.stringify({ articleId: articleId, votes: +x }),
            contentType: "application/json",
            url: "http://localhost:57090/Home/sendvote",   // url here
            success: function (data) { // callback here
                location.reload();
                //console.log(data); // render what you want here
            }
        });
    };

    </script>  


}

